{% extends "page.njk" %}
{% block pageTitle %}{{ query }} - Search - {{ super() }}{% endblock %}

{% from "govuk/components/fieldset/macro.njk" import govukFieldset %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "search/macro/search-result-item/macro.njk" import searchResultItem %}
{% from "search/macro/cicaEnhancedGovukPagination/macro.njk" import cicaEnhancedGovukPagination %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% block innerContent %}

    {{ govukBackLink({
        text: "Back",
        href: "/search"
    }) }}

    {% if errors %}
        {%
            set errorMessageConfig = {
                text: errors[0].text
            }
        %}
        {{ govukErrorSummary({
            titleText: "There is a problem",
            errorList: errors
        }) }}
    {% endif %}

    <form method="post" action="/search">
        {% call govukFieldset({
            legend: {
                text: "Search results",
                classes: "govuk-fieldset__legend--xl",
                isPageHeading: true
            }
        }) %}

            {{ govukInput({
                label: {
                    text: "Search",
                    classes: "govuk-visually-hidden"
                },
                id: "query",
                name: "query",
                value: query,
                errorMessage: errorMessageConfig,
                classes: "govuk-input--width-20 govuk-!-margin-right-4",
                formGroup: {
                    afterInput: {
                        html: govukButton({
                            text: "Search",
                            classes: "govuk-!-margin-bottom-0"
                        })
                    }
                }
            }) }}

            <input type="hidden" name="_csrf" value="{{ csrfToken }}">

        {% endcall %}
    </form>

    {% if searchResults | length %}
        <p class="govuk-body govuk-!-margin-top-4 govuk-!-text-break-word">Showing {{ pagination.from }} to {{ pagination.to }} of {{ pagination.totalItemCount }} results for <em>{{ query }}</em></p>
    {% else %}
        <p class="govuk-body govuk-!-margin-top-4 govuk-!-text-break-word">Showing 0 results for {{ query }}</p>
    {% endif %}

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

    {% for result in searchResults %}
        {% call searchResultItem(result) -%}
            {% if not loop.last %}
                <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
            {%endif %}
        {% endcall %}
    {% else %}
        <p class="govuk-body"><strong>No results found</strong></p>
        <p class="govuk-body">Please try searching again using different word, phrase or question.</p>
    {% endfor %}

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

    {{ cicaEnhancedGovukPagination({
        pagination: pagination,
        query: query
    }) }}

    {% if searchResults | length %}
        <p class="govuk-body govuk-!-margin-top-4 govuk-!-text-break-word">Showing {{ pagination.from }} to {{ pagination.to }} of {{ pagination.totalItemCount }} results for <em>{{ query }}</em></p>
    {% endif %}

{% endblock %}
